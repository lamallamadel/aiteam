<div class="dashboard-container">
  @if (authService.isAuthenticated()) {
    <aside class="sidebar">
      <h1>Atlasia AI</h1>
      <nav>
        <div class="nav-section">
          <span class="section-title">Code Mode</span>
          <a routerLink="/chat" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">New Bolt</a>
          <a routerLink="/dashboard" routerLinkActive="active" class="nav-item">Overview</a>
          <a routerLink="/runs" routerLinkActive="active" class="nav-item">History</a>
          <a routerLink="/oversight" routerLinkActive="active" class="nav-item oversight-item">
            Oversight
            <span *ngIf="escalationService.escalationCount() > 0" class="nav-badge">
              {{ escalationService.escalationCount() }}
            </span>
          </a>
          <a routerLink="/oversight/inbox" routerLinkActive="active" class="nav-item oversight-item">
            Approval Inbox
            <span *ngIf="oversightInboxService.interruptCount() > 0" class="nav-badge">
              {{ oversightInboxService.interruptCount() }}
            </span>
          </a>
        </div>

        <div class="nav-section">
          <span class="section-title">Chat Mode</span>
          <a *ngFor="let gem of personas"
             [routerLink]="['/chat', 'gem', gem.name.toLowerCase()]"
             routerLinkActive="active"
             class="nav-item gem-item">
             <span class="gem-icon">ðŸ’Ž</span> {{ gem.name }}
          </a>
        </div>

        <div class="nav-section">
          <span class="section-title">Insights</span>
          <a routerLink="/analytics" routerLinkActive="active" class="nav-item">Analytics</a>
          <a routerLink="/analytics/failures" routerLinkActive="active" class="nav-item">Failure Patterns</a>
          <a routerLink="/a2a" routerLinkActive="active" class="nav-item">A2A Registry</a>
          <a routerLink="/marketplace" routerLinkActive="active" class="nav-item">Agent Marketplace</a>
        </div>

        <div class="nav-section">
          <span class="section-title">Configuration</span>
          <a routerLink="/config/agents" routerLinkActive="active" class="nav-item">Agent Logic</a>
          <a routerLink="/config/oversight" routerLinkActive="active" class="nav-item">Oversight Rules</a>
        </div>
      </nav>
    </aside>
  }

  <main class="content">
    <header class="top-bar">
      <h2>Orchestrator Control Center</h2>
      @if (authService.isAuthenticated()) {
        <div class="top-bar-actions">
          <button class="theme-toggle" (click)="themeService.toggleTheme()" [attr.aria-label]="themeService.theme() === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'">
            @if (themeService.theme() === 'dark') {
              <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
              </svg>
            } @else {
              <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
              </svg>
            }
          </button>
          <div class="user-menu-container">
            <button class="user-menu-trigger" (click)="toggleUserMenu()">
              <div class="user-avatar">{{ getAvatarLetter() }}</div>
              <span class="user-name">{{ getUsername() }}</span>
            </button>
            @if (userMenuOpen()) {
              <div class="user-menu-dropdown">
                <a routerLink="/profile" class="user-menu-item" (click)="toggleUserMenu()">
                  <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                  Profile
                </a>
                <button class="user-menu-item" (click)="handleLogout()">
                  <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                  </svg>
                  Logout
                </button>
              </div>
            }
          </div>
        </div>
      }
    </header>

    <div class="main-content">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>
<app-toast-container></app-toast-container>
